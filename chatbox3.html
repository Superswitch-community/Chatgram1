<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatGram WhatsApp AI</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{
    background-image: url('https://i.imgur.com/3sKQJ3H.png');
    background-size: cover;
}
</style>
</head>

<body class="flex justify-center items-center h-screen">

<div class="w-full max-w-md h-[95vh] bg-[#efeae2] flex flex-col shadow-2xl rounded-2xl overflow-hidden">

    <!-- Header -->
    <div class="bg-[#075E54] text-white p-3 flex items-center gap-3">
        <img src="https://i.pravatar.cc/40?img=5" class="w-10 h-10 rounded-full">
        <div class="flex-1">
            <h1 class="font-semibold">ChatGram AI</h1>
            <p class="text-xs opacity-80">Online</p>
        </div>
        <span class="text-xl">ðŸ“ž</span>
        <span class="text-xl">ðŸ“¹</span>
    </div>

    <!-- Chat Area -->
    <div id="chatBox" class="flex-1 overflow-y-auto p-4 space-y-3"></div>

    <!-- Input Area -->
    <div class="bg-[#f0f0f0] p-2 flex items-center gap-2">

        <button class="text-xl px-2">ðŸ˜Š</button>

        <input id="userInput" type="text"
            placeholder="Message"
            class="flex-1 px-4 py-2 rounded-full focus:outline-none bg-white">

        <!-- Mic / Send Button -->
        <button id="actionBtn"
            class="bg-[#075E54] text-white w-10 h-10 rounded-full flex items-center justify-center">
            ðŸŽ¤
        </button>
    </div>

</div>

<script>

const OPENAI_API_KEY = "PASTE_YOUR_API_KEY_HERE";

let conversation = [
    { role: "system", content: "You are a friendly WhatsApp-style assistant." }
];

const chatBox = document.getElementById("chatBox");
const userInput = document.getElementById("userInput");
const actionBtn = document.getElementById("actionBtn");

userInput.addEventListener("input", () => {
    if(userInput.value.trim().length > 0){
        actionBtn.innerHTML = "âž¤";
    } else {
        actionBtn.innerHTML = "ðŸŽ¤";
    }
});

actionBtn.addEventListener("click", () => {
    if(userInput.value.trim().length > 0){
        sendMessage();
    } else {
        startRecording();
    }
});

userInput.addEventListener("keypress", (e)=>{
    if(e.key === "Enter") sendMessage();
});

function addMessage(text, isUser){

    const wrapper = document.createElement("div");
    wrapper.className = isUser ? "flex justify-end" : "flex justify-start";

    wrapper.innerHTML = `
        <div class="${isUser ? 'bg-[#DCF8C6]' : 'bg-white'} 
            px-4 py-2 rounded-2xl max-w-xs shadow text-sm">
            ${text}
            <div class="text-[10px] text-gray-500 text-right mt-1">
                ${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}
            </div>
        </div>
    `;

    chatBox.appendChild(wrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage(){

    const message = userInput.value.trim();
    if(!message) return;

    addMessage(message, true);
    conversation.push({ role: "user", content: message });
    userInput.value = "";
    actionBtn.innerHTML = "ðŸŽ¤";

    const typing = document.createElement("div");
    typing.id = "typing";
    typing.className = "text-sm text-gray-500";
    typing.innerText = "AI is typing...";
    chatBox.appendChild(typing);
    chatBox.scrollTop = chatBox.scrollHeight;

    try{
        const response = await fetch("https://api.openai.com/v1/chat/completions",{
            method:"POST",
            headers:{
                "Content-Type":"application/json",
                "Authorization":"Bearer " + OPENAI_API_KEY
            },
            body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: conversation
            })
        });

        const data = await response.json();
        document.getElementById("typing").remove();

        const reply = data.choices[0].message.content;

        addMessage(reply, false);
        conversation.push({ role: "assistant", content: reply });

    }catch(error){
        document.getElementById("typing").remove();
        addMessage("Error connecting to AI.", false);
    }
}

/* ðŸŽ¤ Voice Recording (Speech to Text) */
function startRecording(){
    if(!('webkitSpeechRecognition' in window)){
        alert("Speech recognition not supported in this browser.");
        return;
    }

    const recognition = new webkitSpeechRecognition();
    recognition.lang = "en-US";
    recognition.start();

    recognition.onresult = function(event){
        userInput.value = event.results[0][0].transcript;
        actionBtn.innerHTML = "âž¤";
    };
}

</script>

</body>
</html>
